logger:
  level: DEBUG

input:
  label: "postgres_cdc"
  postgres_cdc:
    dsn: "postgres://${iam_auth_user}@${db_cluster_endpoint}:5432/${db_name}?sslmode=require"
    include_transaction_markers: false
    slot_name: "rpcn_iam_test"
    snapshot_batch_size: 1
    checkpoint_limit: 1
    stream_snapshot: false
    temporary_slot: true
    unchanged_toast_value: null
    schema: public
    tables:
      - "iamuser_test"

    tls:
      # for a quick dev test – *don’t* leave this in production:
      skip_cert_verify: true

    aws:
      enabled: true
      region: "${aws_region}"

      endpoint: "${db_cluster_endpoint}:5432"
      roles:
        - role: "${iam_db_auth_role_arn}"

pipeline:
  processors:
    - mapping: |
        root = this
        root._pg_meta = {
          "table": meta("table"),
          "operation": meta("operation"),
          "lsn": meta("lsn")
        }

output:
  kafka_franz:
    seed_brokers:
      - $${REDPANDA_BROKERS}

    topic: rpcn_iam_auth_topic_test

    tls:
      enabled: true

    sasl:
      - mechanism: SCRAM-SHA-256
        username: ${sasl_username}
        password: ${sasl_password}
